!function(e){var t={};function a(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,a),i.l=!0,i.exports}a.m=e,a.c=t,a.d=function(e,t,n){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)a.d(n,i,function(t){return e[t]}.bind(null,i));return n},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="",a(a.s=0)}([function(e,t,a){"use strict";a.r(t),a.d(t,"startGame",(function(){return B})),a.d(t,"showMap",(function(){return G})),a.d(t,"showBattle",(function(){return K})),a.d(t,"Controllers",(function(){return X})),a.d(t,"nextLevel",(function(){return z})),a.d(t,"restart",(function(){return F}));var n=class{constructor({name:e}){this.element=document.querySelector("[controller='"+e+"']"),this.initDisplay=this.element.style.display,this.visible=!0,this.onInit()}show(e){this.element.style.display=this.initDisplay,this.visible=!0,this.onShow(e)}hide(e){this.element.style.display="none",this.visible=!1,this.onHide(e)}onInit(){}onShow(){}onHide(){}};const i=(e,t)=>(null==t&&(t=e,e=0),Math.floor(Math.random()*(t-e))+e);class s{constructor(e){this.name=e.data.name,this.health=e.data.health,this.attack=e.data.attack,this.defence=e.data.defence,this.dexterity=e.data.dexterity}hit(e){(e-=this.defence)>0&&(this.health-=e)}}const r=(e,t)=>{const a=i(e+t);return{pass:e>a,critical:0===a}};var h=class extends n{onInit(){this.element.querySelector("#attack").addEventListener("click",()=>{this.tick(!0)}),this.enemy=null}tick(e=!1){this.animateAttack();const t=this.player.getDexterity(),a=this.enemy.dexterity;if(!0===e){const e=r(t,a);let n=0;e.critical?n=2*this.player.getDamage():e.pass&&(n=this.player.getDamage()),n>0&&(this.enemy.hit(n),this.updateUi(),this.animate("health","animateNegative")),this.enemy.health<1&&G()}const n=r(a,t);n.critical?this.player.hit(2*this.enemy.attack):n.pass&&this.player.hit(this.enemy.attack),this.player.getHealth()<1&&(alert("You are dead"),F())}onShow(e){this.enemy=new s(e.enemy),this.player=X.stats.getStats(),this.updateUi()}updateUi(){this.element.querySelector("[name]").innerText=this.enemy.name,this.element.querySelector("[health]").innerText=this.enemy.health,this.element.querySelector("[damage]").innerText=this.enemy.attack,this.element.querySelector("[defence]").innerText=this.enemy.defence,this.element.querySelector("[dexterity]").innerText=this.enemy.dexterity}animate(e,t){const a=this.element.querySelector("["+e+"]").classList;a.add(t),setTimeout(()=>{a.remove(t)},250)}animateAttack(){const e=this.element.querySelector("#attack").classList;e.add("animateAttack"),setTimeout(()=>{e.remove("animateAttack")},100)}};var o={EMPTY:0,ENEMY:1,NPO:2};var l=class{constructor({color:e,type:t,onClick:a,onOpen:n,img:i,data:s}){this.color=e,this.type=t,this.shown=!1,this.enemies=0,this.onClick=a,this.onOpen=n,this.img=i,this.enabled=!0,this.data=s}click(){this.onClick&&this.onClick()}open(){this.onOpen&&this.onOpen()}enable(e=!0){this.enabled=e}};function m(){K({enemy:this})}const d=()=>new l({img:"deadEnemy",type:o.ENEMY,onOpen:m,data:{name:"Snake",health:5,attack:2,defence:0,dexterity:9}}),c=()=>new l({img:"deadEnemy",type:o.ENEMY,onOpen:m,data:{name:"Goblin",health:4,attack:2,defence:0,dexterity:7}}),y=()=>new l({img:"deadEnemy",type:o.ENEMY,onOpen:m,data:{name:"Dark elf",health:6,attack:5,defence:0,dexterity:8}}),f=()=>new l({img:"deadEnemy",type:o.ENEMY,onOpen:m,data:{name:"Orc",health:7,attack:5,defence:2,dexterity:5}}),p=()=>new l({img:"deadEnemy",type:o.ENEMY,onOpen:m,data:{name:"Dark Knight",health:10,attack:8,defence:4,dexterity:7}}),u=()=>new l({img:"dungeonEnter",type:o.NPO,onClick:function(){z()}}),x=e=>new l({img:"treasure",type:o.NPO,onClick:function(){this.enabled&&(X.stats.addItem(e),this.enable(!1))}});function g(e,t,a,n){const i=new Image;i.src=t,i.onload=a,this.context=e,this.image=i,this.mapping=n}g.prototype.draw=function(e,t,a){const n=this.mapping[e];this.context.drawImage(this.image,32*n.x,32*n.y,32,32,32*t,32*a,32,32)};var w=g;const v=[{maxTreasures:5,maxItemLevel:4,enemies:[{enemy:c,qty:12},{enemy:d,qty:8}]},{maxTreasures:4,maxItemLevel:8,enemies:[{enemy:f,qty:5},{enemy:c,qty:10},{enemy:d,qty:10}]},{maxTreasures:3,maxItemLevel:12,enemies:[{enemy:f,qty:10},{enemy:y,qty:10},{enemy:c,qty:10}]},{maxTreasures:4,maxItemLevel:16,enemies:[{enemy:f,qty:10},{enemy:y,qty:10},{enemy:c,qty:5},{enemy:p,qty:5},{enemy:d,qty:5}]},{maxTreasures:3,maxItemLevel:20,enemies:[{enemy:f,qty:15},{enemy:y,qty:20},{enemy:p,qty:5}]}],S=1,E=2,k=3;var b=class{constructor({name:e,type:t,effect:a,data:n,monoUse:i=!1}){this.name=e,this.type=t,this.effect=a,this.data=n,this.monoUse=i}use(e){this.effect&&this.effect(e)}};function T(e){e.setWeapon(this)}function q(e){e.setArmor(this)}function M(e){e.heal(this.data.heal)}const I=()=>new b({name:"Dagger",type:E,effect:T,data:{damage:1,dexterity:2}}),O=()=>new b({name:"Wooden stick",type:E,effect:T,data:{damage:1}}),C=[()=>new b({name:"Small health potion",type:S,effect:M,monoUse:!0,data:{heal:1}}),O,I,()=>new b({name:"Mace",type:E,effect:T,data:{damage:6,dexterity:-4}}),()=>new b({name:"Short sword",type:E,effect:T,data:{damage:2,dexterity:1}}),()=>new b({name:"Wooden armor",type:k,effect:q,data:{defence:2,dexterity:-2}}),()=>new b({name:"Leather armor",type:k,effect:q,data:{defence:1,dexterity:0}}),()=>new b({name:"Axe",type:E,effect:T,data:{damage:5,dexterity:-2}}),()=>new b({name:"Sword",type:E,effect:T,data:{damage:3}}),()=>new b({name:"Long sword",type:E,effect:T,data:{damage:4,dexterity:-1}}),()=>new b({name:"Health potion",type:S,effect:M,monoUse:!0,data:{heal:2}}),()=>new b({name:"Silver mace",type:E,effect:T,data:{damage:7,dexterity:-4}}),()=>new b({name:"Steel armor",type:k,effect:q,data:{defence:4,dexterity:-3}}),()=>new b({name:"Two handed sword",type:E,effect:T,data:{damage:7,dexterity:-2}}),()=>new b({name:"Axe",type:E,effect:T,data:{damage:6,dexterity:-2}}),()=>new b({name:"Silver armor",type:k,effect:q,data:{defence:5,dexterity:-3}}),()=>new b({name:"Silver dagger",type:E,effect:T,data:{damage:2,dexterity:2}}),()=>new b({name:"Elder sword",type:E,effect:T,data:{damage:5,dexterity:1}}),()=>new b({name:"Two handed silver sword",type:E,effect:T,data:{damage:8,dexterity:-2}}),()=>new b({name:"Elder armor",type:k,effect:q,data:{defence:6,dexterity:-2}}),()=>new b({name:"Silver sword",type:E,effect:T,data:{damage:4}}),()=>new b({name:"Big health potion",type:S,effect:M,monoUse:!0,data:{heal:3}}),()=>new b({name:"Elder long sword",type:E,effect:T,data:{damage:6}})];var U=class extends n{onInit(){const e=this.element.querySelector("canvas");this.context=e.getContext("2d"),e.addEventListener("click",this.handleClick.bind(this)),this.map=null,this.ready=!1,this.onReady=null,this.sprites=new w(this.context,"./public/tilemap.png",()=>{this.createMap(),this.ready=!0,this.onReady&&this.onReady()},{hero:{x:4,y:0},snake:{x:4,y:1},orc:{x:11,y:0},city:{x:6,y:7},dungeonEnter:{x:4,y:3},treasure:{x:9,y:3},deadEnemy:{x:8,y:7}})}handleClick(e){const t=e.offsetX/32,a=e.offsetY/32,n=Math.floor(t),i=Math.floor(a),s=this.map[n][i];s.shown?null!=s.onClick&&s.onClick():(null!=s.onOpen&&s.onOpen(),this.checkCell(n,i)),this.drawMap()}setOnReady(e){this.onReady=e,this.ready&&this.onReady()}createMap(){this.map=[];for(let e=0;e<16;e++){let t=[];for(let e=0;e<16;e++)t[e]=new l({color:"white",type:o.EMPTY});this.map[e]=t}}createEntities(e,t){let a=0;for(;a<t;){const t=16*Math.random(),n=16*Math.random(),i=Math.floor(t),s=Math.floor(n);this.map[i][s].type===o.EMPTY&&(this.map[i][s]=e(),a++)}}clearCanvas(){this.context.fillStyle="white",this.context.fillRect(0,0,512,512)}checkCell(e,t){this.map[e][t].shown=!0;const a=this.countEnemies(e,t);a>0?this.map[e][t].enemies=a:this.checkEmptyCells(e,t)}checkEmptyCells(e,t){for(let a=e-1;a<=e+1;a++)for(let n=t-1;n<=t+1;n++){if(a!==e&&n!==t)continue;if(a<0||a>=16)continue;if(n<0||n>=16)continue;const i=this.map[a][n];i.shown||i.type!==o.EMPTY&&i.enabled||this.checkCell(a,n)}}drawRect(e,t,a="black"){this.context.fillStyle=a,this.context.fillRect(32*e,32*t,32,32)}drawText(e,t,a,n="red"){this.context.font="20px text",this.context.textAlign="center",this.context.textBaseline="middle",this.context.fillStyle=n,this.context.fillText(a,32*e+16,32*t+16)}drawMap(){let e=null;this.clearCanvas();for(let t=0;t<16;t++)for(let a=0;a<16;a++)if(e=this.map[t][a],e.shown){if(e.type!==o.EMPTY&&e.enabled?null!=e.img?this.sprites.draw(e.img,t,a):this.drawRect(t,a,e.color):(t+a)%2==0?this.drawRect(t,a,"white"):this.drawRect(t,a,"#faded9"),e.enemies>0&&e.type!==o.ENEMY){const n=e.type!==o.EMPTY&&e.enabled?"white":"black";this.drawText(t,a,e.enemies,n)}}else(t+a)%2==0?this.drawRect(t,a,"#364f6b"):this.drawRect(t,a,"#fc5185")}countEnemies(e,t){let a=0;for(let n=e-1;n<=e+1;n++)for(let e=t-1;e<=t+1;e++){if(n<0||n>=16)continue;if(e<0||e>=16)continue;const{type:t,enabled:i}=this.map[n][e];i&&t===o.ENEMY&&a++}return a}buildLevel(e){this.createMap();for(let t=0;t<e.enemies.length;t++){const{enemy:a,qty:n}=e.enemies[t];this.createEntities(a,n)}var t;this.createEntities(u,1),this.createEntities((t=e.maxItemLevel,()=>{const e=i(0,t);return x(C[e]())}),i(2,e.maxTreasures)),this.drawMap()}};var D=class extends n{onInit(){this.stats=null}setStats(e){this.stats=e,this.stats.onUpdate=()=>{this.updateUi()},this.stats.animate=(e,t)=>this.animate(e,t),this.updateUi()}getStats(){return this.stats}updateUi(){this.element.querySelector("[name]").innerText=this.stats.name,this.element.querySelector("[health]").innerText=this.stats.getHealth(),this.element.querySelector("[damage]").innerText=this.stats.getDamage(),this.element.querySelector("[armor]").innerText=this.stats.getArmor(),this.element.querySelector("[dexterity]").innerText=this.stats.getDexterity()}addItem(e){X.inventory.addItem(e)}animate(e,t){const a=this.element.querySelector("["+e+"]").classList;a.add(t),setTimeout(()=>{a.remove(t)},250)}};var L=class{constructor({name:e,health:t=0,damage:a=0,defence:n=0,dexterity:i=0}){this.name=e,this.damage=a,this.health=t,this.defence=n,this.dexterity=i,this.weapon=null,this.armor=null,this.onUpdate=null,this.def={health:t,damage:a}}setWeapon(e){const t=this.getDamage(),a=this.getDexterity();return this.weapon=e,this.onUpdate&&this.onUpdate(),t<this.getDamage()?this.animate&&this.animate("damage","animatePositive"):t>this.getDamage()&&this.animate&&this.animate("damage","animateNegative"),a<this.getDexterity()?this.animate&&this.animate("dexterity","animatePositive"):a>this.getDexterity()&&this.animate&&this.animate("dexterity","animateNegative"),this}setArmor(e){const t=this.getArmor(),a=this.getDexterity();return this.armor=e,this.onUpdate&&this.onUpdate(),t<this.getArmor()?this.animate&&this.animate("armor","animatePositive"):t>this.getArmor()&&this.animate&&this.animate("armor","animateNegative"),a<this.getDexterity()?this.animate&&this.animate("dexterity","animatePositive"):a>this.getDexterity()&&this.animate&&this.animate("dexterity","animateNegative"),this}heal(e=1){return this.health+=e,this.health>this.def.health?this.health=this.def.health:this.animate&&this.animate("health","animatePositive"),this.onUpdate&&this.onUpdate(),this}getHealth(){return this.health}getDamage(){let e=this.damage;return null!=this.weapon&&(e+=this.weapon.data.damage),e}getArmor(){let e=this.defence;return null!=this.armor&&(e+=this.armor.data.defence),e}getDexterity(){let e=this.dexterity;return null!=this.armor&&(e+=this.armor.data.dexterity||0),null!=this.weapon&&(e+=this.weapon.data.dexterity||0),e}hit(e){(e-=this.getArmor())>0&&(this.health-=e),this.onUpdate&&this.onUpdate()}};var P=class extends n{onInit(){this._onStart=null,this.element.querySelector("[enter]").addEventListener("click",()=>{const e=this.element.querySelector("#heroSelect").value;this._onStart&&this._onStart({hero:e})})}onStart(e){this._onStart=e}};const N=e=>{const t=document.createElement("div"),a=document.createElement("p"),n=document.createElement("button"),i=document.createElement("button");return a.innerText=e.name,n.innerText="Use",n.addEventListener("click",()=>{e.use(X.stats.getStats()),e.monoUse&&X.inventory.dropItem(e)}),i.innerText="Drop",i.addEventListener("click",()=>{X.inventory.dropItem(e)}),t.appendChild(a),t.appendChild(n),t.appendChild(i),t};var R=class extends n{onInit(){this.items=[]}addItem(e){this.items.push(e),this.renderInventory()}dropItem(e){for(let t=0;t<this.items.length;t++)if(this.items[t]===e)return this.items.splice(t,1),this.renderInventory(),!0;return!1}renderInventory(){const e=this.element.querySelector("[items]");e.innerHTML=null;for(let t=0;t<this.items.length;t++)e.appendChild(N(this.items[t]))}clear(){this.items=[]}};const Y=new U({name:"map"}),A=new h({name:"battle"}),_=new D({name:"stats"}),j=new P({name:"hero"}),H=new R({name:"inventory"});let W=0;const B=({hero:e})=>{Y.setOnReady(()=>{const e=v[W];Y.buildLevel(e)});let t=null;switch(e){case"warrior":t={name:"Warrior",health:6,damage:3,defence:2,dexterity:7};break;case"thief":t={name:"Thief",health:4,damage:2,defence:0,dexterity:11,startItems:[I()]};break;case"rogue":t={name:"Rogue",health:5,damage:2,defence:1,dexterity:9,startItems:[O()]}}const a=new L(t);if(_.setStats(a),null!=t.startItems)for(let e=0;e<t.startItems.length;e++)_.addItem(t.startItems[e]);_.show(),H.show(),j.hide(),G()},G=e=>{Y.show(e),A.hide()},K=e=>{Y.hide(),A.show(e)},X={map:Y,battle:A,stats:_,inventory:H},z=()=>{W++;const e=v[W];Y.buildLevel(e)},F=()=>{W=0,Y.hide(),A.hide(),_.hide(),H.hide(),H.clear(),j.show()};j.onStart(({hero:e})=>{B({hero:e})}),F()}]);